<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Command Center | Universal AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --slate-950: #020617;
            --slate-900: #0f172a;
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --emerald: #10b981;
        }
        body {
            background-color: var(--slate-950);
            font-family: 'Plus Jakarta Sans', sans-serif;
            color: #f1f5f9;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        .glass-sidebar {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(30px);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }
        .glass-main {
            background: radial-gradient(circle at 50% 0%, rgba(99, 102, 241, 0.1) 0%, transparent 75%);
        }
        .neural-input-container {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .neural-input-container:focus-within {
            border-color: var(--accent);
            box-shadow: 0 0 30px var(--accent-glow);
            background: rgba(15, 23, 42, 1);
        }
        .console-font { font-family: 'Fira Code', monospace; }

        .nav-item {
            transition: all 0.2s ease;
            border: 1px solid transparent;
            cursor: pointer;
        }
        .nav-item.active {
            background: rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.3);
        }
        .nav-item:hover:not(.active) {
            background: rgba(255, 255, 255, 0.03);
        }

        /* Cursor Prompter */
        .cursor-blink::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 80px;
            background: var(--accent);
            margin-left: 10px;
            animation: blink 1s infinite;
            vertical-align: middle;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* Sembunyikan Scrollbar */
        #chat-viewport::-webkit-scrollbar { display: none; }
        #chat-viewport { -ms-overflow-style: none; scrollbar-width: none; }

        .welcome-screen {
            transition: opacity 0.8s ease, transform 0.8s ease;
        }
        .hidden-welcome {
            opacity: 0;
            transform: scale(0.95);
            pointer-events: none;
        }
    </style>
</head>
<body class="flex h-screen w-screen select-text">

    <aside class="w-80 glass-sidebar flex flex-col z-20 shrink-0 select-none">
        <div class="p-8 border-b border-white/5">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center shadow-2xl shadow-indigo-500/40 animate-pulse">
                    <img src="icon.svg" class="w-7 h-7" alt="NT" onerror="this.src='https://flowork.cloud/api/v1/components/app/chatgpt_app/icon'">
                </div>
                <div>
                    <h2 class="font-extrabold tracking-tighter text-xl text-white">NEURAL <span class="text-indigo-500">v3</span></h2>
                    <div class="flex items-center gap-1.5">
                        <div id="status-led" class="w-1.5 h-1.5 rounded-full bg-slate-500 transition-colors duration-500"></div>
                        <p id="bridge-text" class="text-[9px] text-slate-500 font-black uppercase tracking-[0.2em]">Syncing...</p>
                    </div>
                </div>
            </div>
        </div>

        <nav class="flex-1 p-6 space-y-4 overflow-y-auto">
            <p class="text-[10px] font-black text-slate-600 uppercase tracking-[0.3em] mb-4 px-2">Select Neural Engine</p>

            <div id="model-openai" onclick="selectModel('openai')" class="nav-item active p-4 rounded-2xl group">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-indigo-400 text-[11px] font-bold uppercase tracking-widest">ChatGPT (OpenAI)</span>
                    <span class="text-[9px] font-mono text-indigo-500/60">GPT-4o</span>
                </div>
                <div class="h-1 w-full bg-slate-800 rounded-full overflow-hidden">
                    <div class="h-full bg-indigo-500" style="width: 100%"></div>
                </div>
            </div>

            <div id="model-gemini" onclick="selectModel('gemini')" class="nav-item p-4 rounded-2xl group">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-slate-500 text-[11px] font-bold uppercase tracking-widest group-hover:text-blue-400">Gemini (Google)</span>
                    <span class="text-[9px] font-mono text-slate-700 uppercase group-hover:text-blue-500">Pro 1.5</span>
                </div>
                <div class="h-1 w-full bg-slate-800/50 rounded-full overflow-hidden">
                    <div class="h-full bg-blue-500" style="width: 100%"></div>
                </div>
            </div>

            <div id="model-deepseek" onclick="selectModel('deepseek')" class="nav-item p-4 rounded-2xl group">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-slate-500 text-[11px] font-bold uppercase tracking-widest group-hover:text-purple-400">DeepSeek (V3)</span>
                    <span class="text-[9px] font-mono text-slate-700 uppercase group-hover:text-purple-500">Strategic</span>
                </div>
                <div class="h-1 w-full bg-slate-800/50 rounded-full overflow-hidden">
                    <div class="h-full bg-purple-500" style="width: 100%"></div>
                </div>
            </div>
        </nav>

        <div class="p-6 border-t border-white/5 bg-slate-950/50">
            <div class="space-y-4">
                <div class="flex justify-between items-center text-[10px] font-bold uppercase tracking-widest">
                    <span class="text-slate-500">Engine Vital</span>
                    <span id="memory-val" class="text-indigo-500">0.05%</span>
                </div>
                <div class="h-1 bg-slate-800 rounded-full overflow-hidden">
                    <div id="memory-bar" class="h-full bg-indigo-500" style="width: 5%"></div>
                </div>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col glass-main relative overflow-hidden">
        <header class="h-24 border-b border-white/5 flex items-center justify-between px-12 z-10 bg-slate-950/20 select-none">
            <div class="flex flex-col">
                <span class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] mb-1">Active Neural Instance</span>
                <div class="flex items-center gap-3">
                    <span id="active-model-name" class="bg-indigo-500/10 text-indigo-400 text-[11px] font-bold px-4 py-1.5 rounded-full border border-indigo-500/20 uppercase tracking-widest">ChatGPT-4o</span>
                    <div class="h-4 w-px bg-white/10"></div>
                    <span id="ping-display" class="text-slate-400 text-xs font-mono uppercase">Latency: --ms</span>
                </div>
            </div>
            <div class="flex items-center gap-6">
                <button id="copy-btn" onclick="copyFullResponse()" class="hidden text-indigo-400 hover:text-white transition-colors uppercase text-[10px] font-bold tracking-widest border border-indigo-500/30 px-4 py-2 rounded-lg bg-indigo-500/5">Copy Full Response</button>
                <button onclick="clearSynthesis()" class="text-slate-600 hover:text-red-400 transition-colors uppercase text-[10px] font-bold tracking-widest">Purge Context</button>
            </div>
        </header>

        <section class="flex-1 flex items-center justify-center p-12 relative" id="chat-viewport">
            <div id="welcome-container" class="welcome-screen absolute inset-0 flex flex-col items-center justify-center text-center z-10">
                <div class="w-32 h-32 bg-indigo-600 rounded-[2.5rem] flex items-center justify-center shadow-3xl shadow-indigo-500/30 mb-8">
                    <img src="https://flowork.cloud/logo.svg" class="w-16 h-16" alt="Flowork">
                </div>
                <h1 class="text-5xl font-extrabold tracking-tighter text-white mb-4">Welcome, Commander</h1>
                <p class="text-slate-500 uppercase tracking-[0.5em] text-xs font-black">Neural Bridge Ready for Synthesis</p>
            </div>

            <div id="prompter-display" class="w-full max-w-7xl text-center">
                <div id="active-line" class="text-7xl lg:text-8xl font-bold text-white leading-tight cursor-blink whitespace-pre-wrap select-text"></div>
            </div>
        </section>

        <section class="h-24 bg-slate-950/80 border-t border-white/5 px-12 py-4 flex items-center gap-8 z-10 select-none">
            <div id="log-console" class="flex-1 console-font text-[10px] text-slate-600 space-y-1 overflow-hidden">
                <p>> SYSTEM_READY: AWAITING INPUT...</p>
            </div>
        </section>

        <section class="p-12 pt-0 z-10 select-none">
            <div class="max-w-5xl mx-auto">
                <div class="neural-input-container rounded-[2.5rem] p-3 flex items-end gap-4 shadow-3xl">
                    <textarea id="neural-prompt" rows="1"
                        class="flex-1 bg-transparent border-none p-6 text-slate-100 outline-none placeholder:text-slate-700 resize-none h-[80px] text-lg"
                        placeholder="Initiate neural command..."></textarea>

                    <button id="trigger-synth"
                        class="mb-3 mr-3 w-16 h-16 bg-indigo-600 hover:bg-indigo-500 text-white rounded-[1.5rem] flex items-center justify-center transition-all shadow-xl shadow-indigo-500/20">
                        <svg id="synth-icon" class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <script>
        let currentModel = 'openai';
        let fullResponseBuffer = ""; // Menyimpan seluruh teks untuk di-copy
        const modelNames = { 'openai': 'ChatGPT-4o', 'gemini': 'Gemini 1.5 Pro', 'deepseek': 'DeepSeek V3' };

        function selectModel(id) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`model-${id}`).classList.add('active');
            currentModel = id;
            document.getElementById('active-model-name').innerText = modelNames[id];
            pushLog(`SWITCHING_ENGINE: ${modelNames[id]}`, 'warn');
        }

        function pushLog(msg, type = 'default') {
            const colors = { default: 'text-slate-600', success: 'text-emerald-500/70', warn: 'text-indigo-500', error: 'text-red-400' };
            const p = document.createElement('p');
            p.className = colors[type] || colors.default;
            p.innerText = `> ${new Date().toLocaleTimeString()} | ${msg}`;
            const console = document.getElementById('log-console');
            console.appendChild(p);
            if(console.children.length > 3) console.removeChild(console.firstChild);
        }

        async function apiCall(action, data) {
            const url = `/api/v1/apps/execute/chatgpt_app/${action}`;
            try {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return await res.json();
            } catch (e) {
                return { status: 'error', message: e.message };
            }
        }

        function cleanNeuralText(text) {
            if (!text) return "";
            return text
                .replace(/\*\*(.*?)\*\*/g, '$1')
                .replace(/\*(.*?)\*/g, '$1')
                .replace(/__(.*?)__/g, '$1')
                .replace(/###\s/g, '')
                .replace(/##\s/g, '')
                .replace(/#\s/g, '')
                .replace(/-\s/g, 'â€¢ ')
                .trim();
        }

        /**
         * Logic Prompter 1 Baris
         */
        function renderPrompter(rawText) {
            const text = cleanNeuralText(rawText);
            fullResponseBuffer = text; // Simpan ke buffer

            const display = document.getElementById('active-line');
            const welcome = document.getElementById('welcome-container');
            const copyBtn = document.getElementById('copy-btn');

            // Sembunyikan Welcome Screen
            welcome.classList.add('hidden-welcome');
            copyBtn.classList.add('hidden');

            display.innerHTML = "";
            let i = 0;
            const typingSpeed = 60; // Sedikit lebih lambat untuk efek sinematik prompter

            const timer = setInterval(() => {
                if (i < text.length) {
                    const char = text.charAt(i);

                    // Jika menemukan newline, bersihkan layar (Prompter Logic)
                    if (char === '\n') {
                        display.innerHTML = "";
                    } else {
                        display.innerHTML += char;
                    }

                    i++;
                } else {
                    clearInterval(timer);
                    pushLog("SYNTHESIS_COMPLETE", "success");
                    copyBtn.classList.remove('hidden');
                }
            }, typingSpeed);
        }

        function copyFullResponse() {
            navigator.clipboard.writeText(fullResponseBuffer);
            pushLog("DATA_COPIED_TO_CLIPBOARD", "success");
            alert("Full response copied to clipboard!");
        }

        function clearSynthesis() {
            window.location.reload();
        }

        // Enter to Send
        document.getElementById('neural-prompt').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                document.getElementById('trigger-synth').click();
            }
        });

        document.getElementById('trigger-synth').onclick = async () => {
            const prompt = document.getElementById('neural-prompt').value.trim();
            if(!prompt) return;

            pushLog(`ENGAGING_${currentModel.toUpperCase()}_ENGINE...`, 'warn');
            document.getElementById('trigger-synth').disabled = true;
            document.getElementById('synth-icon').classList.add('animate-spin');

            const startTime = Date.now();
            const result = await apiCall('generate', { prompt, model_provider: currentModel });
            const endTime = Date.now();

            document.getElementById('ping-display').innerText = `Latency: ${endTime - startTime}ms`;

            if(result.status === 'success' || result.data) {
                pushLog("NEURAL_DATA_RECEIVED", "success");
                renderPrompter(result.data || result.message);
            } else {
                pushLog("SYNTHESIS_FAILED", "error");
                document.getElementById('active-line').innerHTML = `<span class="text-red-500 text-3xl uppercase">Error: ${result.error || result.message}</span>`;
            }

            document.getElementById('trigger-synth').disabled = false;
            document.getElementById('synth-icon').classList.remove('animate-spin');
            document.getElementById('neural-prompt').value = "";
        };

        setInterval(async () => {
            try {
                const res = await apiCall('status', {});
                document.getElementById('status-led').className = "w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-lg";
                document.getElementById('bridge-text').innerText = "Bridge Active";
            } catch {
                document.getElementById('status-led').className = "w-1.5 h-1.5 rounded-full bg-red-500";
                document.getElementById('bridge-text').innerText = "Bridge Lost";
            }
        }, 8000);
    </script>
</body>
</html>
